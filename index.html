<!-- index.html -->
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Tournament Hub</title>
    <style>
        :root{
            --bg:#0f1724;
            --card:#0b1220;
            --accent:#6ee7b7;
            --muted:#94a3b8;
            --glass: rgba(255,255,255,0.03);
            --glass-2: rgba(255,255,255,0.02);
            --radius:14px;
            font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
        }
        *{box-sizing:border-box}
        body{
            margin:0;
            min-height:100vh;
            background:
                radial-gradient(800px 400px at 10% 10%, rgba(110,231,183,0.06), transparent 10%),
                radial-gradient(700px 300px at 90% 90%, rgba(99,102,241,0.04), transparent 10%),
                var(--bg);
            color:#e6eef3;
            -webkit-font-smoothing:antialiased;
            -moz-osx-font-smoothing:grayscale;
            padding:36px;
            display:flex;
            justify-content:center;
            align-items:flex-start;
            gap:20px;
        }

        .container{
            width:1100px;
            max-width:calc(100% - 48px);
            display:grid;
            grid-template-columns: 360px 1fr;
            gap:22px;
        }

        .sidebar{
            background:linear-gradient(180deg,var(--card), rgba(11,18,32,0.9));
            border-radius:var(--radius);
            padding:20px;
            box-shadow: 0 6px 30px rgba(2,6,23,0.6);
        }

        .brand{
            display:flex;
            gap:12px;
            align-items:center;
            margin-bottom:16px;
        }
        .brand .logo{
            width:52px;height:52px;border-radius:12px;
            background:linear-gradient(135deg,var(--accent),#60a5fa);
            display:flex;align-items:center;justify-content:center;font-weight:700;color:#07202a;
            box-shadow: 0 6px 20px rgba(99,102,241,0.12);
        }
        h1{font-size:18px;margin:0}
        p.lead{color:var(--muted);font-size:13px;margin-top:6px}

        .profile{
            margin-top:18px;
            display:flex;gap:12px;align-items:center;
        }
        .avatar{
            width:62px;height:62px;border-radius:12px;background:linear-gradient(135deg,#334155,#0ea5a2);
            display:flex;align-items:center;justify-content:center;font-weight:700;font-size:20px;
        }
        .meta{flex:1}
        .meta .name{font-weight:600}
        .meta .email{color:var(--muted);font-size:13px;margin-top:4px}

        .nav{
            margin-top:22px;display:flex;flex-direction:column;gap:8px;
        }
        .btn{
            background:var(--glass);
            border:1px solid rgba(255,255,255,0.03);
            color:var(--accent);
            padding:10px 12px;border-radius:10px;font-weight:600;
            cursor:pointer;
        }
        .btn.secondary{background:transparent;color:#cbd5e1;border:1px solid rgba(255,255,255,0.04)}
        .btn.full{width:100%}

        .card{
            background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
            padding:18px;border-radius:14px;border:1px solid rgba(255,255,255,0.03);
            box-shadow: 0 6px 30px rgba(2,6,23,0.45);
        }

        .main{
            display:flex;flex-direction:column;gap:18px;
        }
        .header-row{display:flex;justify-content:space-between;align-items:center;gap:12px}
        .search{
            display:flex;gap:8px;align-items:center;background:var(--glass-2);padding:8px;border-radius:10px;
        }
        .search input{background:transparent;border:0;color:inherit;outline:0;width:260px}

        .tournaments{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:14px}
        .tourney{
            padding:14px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);
            border:1px solid rgba(255,255,255,0.03);
        }
        .tourney h3{margin:0;font-size:16px}
        .tourney p{color:var(--muted);font-size:13px;margin:8px 0 12px}
        .muted{color:var(--muted);font-size:13px}
        .flex{display:flex;gap:8px;align-items:center}

        /* modals */
        .modal-backdrop{position:fixed;inset:0;background:rgba(2,6,23,0.6);display:none;justify-content:center;align-items:center;padding:20px;z-index:50}
        .modal{width:420px;max-width:100%;background:linear-gradient(180deg,var(--card), rgba(11,18,32,0.98));border-radius:12px;padding:18px;border:1px solid rgba(255,255,255,0.03)}
        .modal h2{margin:0 0 8px;font-size:18px}
        .field{display:flex;flex-direction:column;margin-top:10px}
        .field label{font-size:13px;color:var(--muted);margin-bottom:6px}
        .field input, .field select, .field textarea{
            background:transparent;border:1px solid rgba(255,255,255,0.04);padding:10px;border-radius:8px;color:inherit;outline:0
        }
        .error{color:#ffb4b4;font-size:13px;margin-top:8px}

        footer{color:var(--muted);font-size:13px;padding:12px 0;text-align:center}
        @media (max-width:880px){
            .container{grid-template-columns:1fr;align-items:center}
            .sidebar{order:2}
        }
    </style>
</head>
<body>
    <div class="container">
        <aside class="sidebar card">
            <div class="brand">
                <div class="logo">TH</div>
                <div>
                    <h1>Tournament Hub</h1>
                    <p class="lead">Create, join and manage tournaments with ease.</p>
                </div>
            </div>

            <div class="profile" id="profileBox">
                <div class="avatar" id="avatar">G</div>
                <div class="meta">
                    <div class="name" id="profileName">Guest</div>
                    <div class="email" id="profileEmail">Not signed in</div>
                </div>
            </div>

            <div class="nav" style="margin-top:18px">
                <button class="btn full" id="openRegister">Register</button>
                <button class="btn secondary full" id="openLogin">Login</button>
                <button class="btn full" id="openCreate">Create Tournament</button>
                <button class="btn secondary full" id="logoutBtn" style="display:none">Logout</button>
            </div>

            <div style="margin-top:18px">
                <div class="card" style="padding:12px">
                    <div class="muted">Quick tips</div>
                    <ul style="margin:8px 0 0;padding-left:18px;color:var(--muted)">
                        <li>Register to create tournaments</li>
                        <li>Share link to invite players</li>
                        <li>Manage brackets and scores</li>
                    </ul>
                </div>
            </div>
        </aside>

        <main class="main">
            <div class="card header-row">
                <div style="display:flex;gap:12px;align-items:center">
                    <div>
                        <h2 style="margin:0">Active Tournaments</h2>
                        <div class="muted" id="tourneyCount">Loading…</div>
                    </div>
                </div>
                <div class="flex">
                    <div class="search card" style="padding:8px 12px;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="opacity:0.7"><path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><circle cx="11" cy="11" r="6" stroke="currentColor" stroke-width="1.5"/></svg>
                        <input id="search" placeholder="Search tournaments, games..." />
                    </div>
                </div>
            </div>

            <div class="card">
                <div id="tournaments" class="tournaments">
                    <!-- tournaments injected here -->
                </div>
                <div id="emptyNotice" class="muted" style="margin-top:12px">No tournaments yet. Create one!</div>
            </div>

            <footer>
                Built with care • Simple backend (Node/Express) expected on /api
            </footer>
        </main>
    </div>

    <!-- Modals -->
    <div class="modal-backdrop" id="modalRoot" aria-hidden="true">
        <div class="modal" role="dialog" id="modalContent"></div>
    </div>

    <script>
        const api = (path, opts) =>
            fetch('/api' + path, {
                headers: { 'Content-Type': 'application/json', ...(opts && opts.token ? { Authorization: 'Bearer ' + opts.token } : {}) },
                ...(opts || {})
            }).then(r => r.json());

        // UI helpers
        const modalRoot = document.getElementById('modalRoot');
        const modalContent = document.getElementById('modalContent');

        function openModal(html) {
            modalContent.innerHTML = html;
            modalRoot.style.display = 'flex';
            modalRoot.setAttribute('aria-hidden','false');
            modalRoot.querySelectorAll('button[data-close]').forEach(b => b.addEventListener('click', closeModal));
            modalRoot.querySelectorAll('form').forEach(f => f.addEventListener('submit', formHandler));
        }
        function closeModal(){ modalRoot.style.display = 'none'; modalRoot.setAttribute('aria-hidden','true'); modalContent.innerHTML=''; }

        // forms central handler
        async function formHandler(e){
            e.preventDefault();
            const form = e.target;
            if(form.dataset.action === 'register') await handleRegister(new FormData(form));
            if(form.dataset.action === 'login') await handleLogin(new FormData(form));
            if(form.dataset.action === 'create') await handleCreate(new FormData(form));
        }

        // auth state
        function getToken(){ return localStorage.getItem('token'); }
        function setToken(t){ if(t) localStorage.setItem('token', t); else localStorage.removeItem('token'); }

        async function init(){
            bindUI();
            await loadTournaments();
            await refreshProfile();
        }

        function bindUI(){
            document.getElementById('openRegister').addEventListener('click', ()=> openRegister());
            document.getElementById('openLogin').addEventListener('click', ()=> openLogin());
            document.getElementById('openCreate').addEventListener('click', ()=> openCreate());
            document.getElementById('logoutBtn').addEventListener('click', async ()=>{
                setToken(null);
                await refreshProfile();
            });
            document.getElementById('search').addEventListener('input', (e)=> filterTournaments(e.target.value));
            modalRoot.addEventListener('click', (ev)=> { if(ev.target === modalRoot) closeModal(); });
        }

        function openRegister(){
            openModal(`
                <h2>Register</h2>
                <form data-action="register">
                    <div class="field"><label>Full name</label><input name="name" required/></div>
                    <div class="field"><label>Email</label><input name="email" type="email" required/></div>
                    <div class="field"><label>Password</label><input name="password" type="password" minlength="6" required/></div>
                    <div style="display:flex;gap:8px;margin-top:12px">
                        <button class="btn" type="submit">Create account</button>
                        <button class="btn secondary" data-close type="button">Cancel</button>
                    </div>
                    <div class="error" id="regErr"></div>
                </form>
            `);
        }

        function openLogin(){
            openModal(`
                <h2>Login</h2>
                <form data-action="login">
                    <div class="field"><label>Email</label><input name="email" type="email" required/></div>
                    <div class="field"><label>Password</label><input name="password" type="password" required/></div>
                    <div style="display:flex;gap:8px;margin-top:12px">
                        <button class="btn" type="submit">Sign in</button>
                        <button class="btn secondary" data-close type="button">Cancel</button>
                    </div>
                    <div class="error" id="loginErr"></div>
                </form>
            `);
        }

        function openCreate(){
            const token = getToken();
            if(!token){ openLogin(); return; }
            openModal(`
                <h2>Create Tournament</h2>
                <form data-action="create">
                    <div class="field"><label>Title</label><input name="title" required/></div>
                    <div class="field"><label>Game</label><input name="game" required/></div>
                    <div class="field"><label>Type</label>
                        <select name="type"><option>Single Elimination</option><option>Double Elimination</option><option>Round Robin</option></select>
                    </div>
                    <div class="field"><label>Max players</label><input name="maxPlayers" type="number" min="2" value="8" required/></div>
                    <div style="display:flex;gap:8px;margin-top:12px">
                        <button class="btn" type="submit">Create</button>
                        <button class="btn secondary" data-close type="button">Cancel</button>
                    </div>
                    <div class="error" id="createErr"></div>
                </form>
            `);
        }

        async function handleRegister(formData){
            const payload = Object.fromEntries(formData);
            try{
                const res = await fetch('/api/register',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
                const data = await res.json();
                if(!res.ok) throw new Error(data.message || 'Failed');
                setToken(data.token);
                closeModal();
                await refreshProfile();
            }catch(err){
                document.getElementById('regErr').textContent = err.message;
            }
        }

        async function handleLogin(formData){
            const payload = Object.fromEntries(formData);
            try{
                const res = await fetch('/api/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
                const data = await res.json();
                if(!res.ok) throw new Error(data.message || 'Login failed');
                setToken(data.token);
                closeModal();
                await refreshProfile();
            }catch(err){
                document.getElementById('loginErr').textContent = err.message;
            }
        }

        async function handleCreate(formData){
            const payload = Object.fromEntries(formData);
            try{
                const res = await fetch('/api/tournaments',{method:'POST',headers:{'Content-Type':'application/json', 'Authorization': 'Bearer '+getToken()},body:JSON.stringify(payload)});
                const data = await res.json();
                if(!res.ok) throw new Error(data.message || 'Create failed');
                closeModal();
                await loadTournaments();
            }catch(err){
                document.getElementById('createErr').textContent = err.message;
            }
        }

        async function refreshProfile(){
            const token = getToken();
            const profileName = document.getElementById('profileName');
            const profileEmail = document.getElementById('profileEmail');
            const avatar = document.getElementById('avatar');
            const loginBtn = document.getElementById('openLogin');
            const regBtn = document.getElementById('openRegister');
            const logoutBtn = document.getElementById('logoutBtn');

            if(!token){ profileName.textContent='Guest'; profileEmail.textContent='Not signed in'; avatar.textContent='G'; logoutBtn.style.display='none'; return; }
            try{
                const res = await fetch('/api/me',{headers:{'Authorization':'Bearer '+token}});
                const data = await res.json();
                if(!res.ok) throw new Error('Invalid token');
                profileName.textContent = data.name;
                profileEmail.textContent = data.email;
                avatar.textContent = (data.name||'G').split(' ').map(s=>s[0]).slice(0,2).join('');
                logoutBtn.style.display='block';
            }catch(e){
                setToken(null);
                profileName.textContent='Guest'; profileEmail.textContent='Not signed in'; avatar.textContent='G';
                logoutBtn.style.display='none';
            }
        }

        async function loadTournaments(){
            try{
                const res = await fetch('/api/tournaments');
                const list = await res.json();
                const wrap = document.getElementById('tournaments');
                const count = document.getElementById('tourneyCount');
                wrap.innerHTML = '';
                if(list.length === 0){ document.getElementById('emptyNotice').style.display = 'block'; } else document.getElementById('emptyNotice').style.display = 'none';
                count.textContent = `${list.length} active`;
                list.forEach(t => {
                    const el = document.createElement('div');
                    el.className = 'tourney';
                    el.innerHTML = `
                        <h3>${escapeHtml(t.title)}</h3>
                        <div class="muted">${escapeHtml(t.game)} • ${escapeHtml(t.type)}</div>
                        <p class="muted">${t.maxPlayers} players • created by ${escapeHtml(t.creatorName)}</p>
                        <div style="display:flex;gap:8px;margin-top:10px">
                            <button class="btn" onclick="joinTourney('${t.id}')">Join</button>
                            <button class="btn secondary" onclick="viewTourney('${t.id}')">Details</button>
                        </div>
                    `;
                    wrap.appendChild(el);
                });
            }catch(e){
                console.error(e);
            }
        }

        function escapeHtml(s){ if(!s) return ''; return String(s).replace(/[&<>"]/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;' })[c]); }

        function filterTournaments(q){
            q = q.toLowerCase().trim();
            document.querySelectorAll('.tourney').forEach(el=>{
                const t = el.querySelector('h3').textContent + ' ' + el.querySelector('.muted').textContent;
                el.style.display = t.toLowerCase().includes(q) ? '' : 'none';
            });
        }

        window.joinTourney = async (id) => {
            alert('Joining feature is demo-only. In a full app this would call the backend.');
        };
        window.viewTourney = async (id) => {
            const res = await fetch('/api/tournaments');
            const list = await res.json();
            const t = list.find(x=>x.id===id);
            if(!t) return;
            openModal(`
                <h2>${escapeHtml(t.title)}</h2>
                <div class="muted">${escapeHtml(t.game)} • ${escapeHtml(t.type)}</div>
                <p style="margin-top:12px" class="muted">Max players: ${t.maxPlayers}</p>
                <p style="margin-top:12px" class="muted">Created by: ${escapeHtml(t.creatorName)}</p>
                <div style="display:flex;margin-top:12px;gap:8px">
                    <button class="btn" data-close>Close</button>
                </div>
            `);
        }

        // Kick off
        init();
    </script>
</body>
</html>